# /etc/systemd/system/etcd2.service.d/20-puppet.conf
# This file was generated by Puppet, http://go.epfl.ch/epflsti-coreos-puppet

[Service]
Environment="ETCD_ADVERTISE_CLIENT_URLS=http://<%= @ipaddress %>:2379"
Environment="ETCD_INITIAL_ADVERTISE_PEER_URLS=http://<%= @ipaddress %>:2380"
Environment="ETCD_LISTEN_CLIENT_URLS=http://0.0.0.0:2379,http://0.0.0.0:4001"
Environment="ETCD_LISTEN_PEER_URLS=http://<%= @ipaddress %>:2380,http://<%= @ipaddress %>:7001"
Environment="ETCD_NAME=<%= @fqdn %>"
# https://github.com/coreos/etcd/blob/master/Documentation/clustering.md says
# that ETCD_INITIAL_CLUSTER_* parameters are only looked at if there is no
# state in /var/lib/etcd2 (i.e., fresh reinstall)
Environment="ETCD_INITIAL_CLUSTER=<% @quorum_members.each do |k,v| -%>
<%= k %>=http://<%= v %>:2380,<% end -%>"
<% if @is_member %>
Environment="ETCD_INITIAL_CLUSTER_STATE=existing"
<% else %>
Environment="ETCD_PROXY=on"
<% end %>
